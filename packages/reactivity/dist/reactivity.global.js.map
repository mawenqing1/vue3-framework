{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { reactive } from \"./reactive\";\nexport { effect } from \"./effect\";", "export const isObj = (val) => {\n    return typeof val === 'object' && val !== null\n}", "export let activeEffect = undefined;\n\nexport class ReactiveEffect {\n    public active = true;\n    public parent = null;\n    public deps = [];\n    public fn\n    constructor(fn) {\n        this.fn = fn;\n    }\n    run() {\n        if(!this.active) {\n            this.fn()\n        } else {\n            try {\n                this.parent = activeEffect;\n                activeEffect = this;\n                return this.fn()\n            } finally {\n                activeEffect = this.parent;\n                this.parent = null;\n            }\n        }\n    }\n};\n\n//map {object: {name:[effect, effect], age:[effect,effect]}}\nconst targetMap = new WeakMap();\nexport function trigger(target, key, value) {\n    let depsMap = targetMap.get(target);\n    if(!depsMap) {\n        return;\n    }\n    const effects = depsMap.get(key);\n    effects && effects.forEach(effect => { \n        if(effect !== activeEffect) {\n            effect.run();\n        }\n    });\n};\n\nexport function track(target, key) {\n    if(activeEffect) {\n        let depsMap = targetMap.get(target);\n        if(!depsMap) {\n            targetMap.set(target, (depsMap = new Map()));\n        }\n        let deps = depsMap.get(key);\n        if(!deps) {\n            depsMap.set(key, (deps = new Set()));\n        }\n        let shouldTrack = !deps.has(activeEffect);\n        if(shouldTrack) {\n            deps.add(activeEffect);\n            activeEffect.deps.push(deps);\n        }\n    }\n    console.log(targetMap);\n    \n}\n\nexport function effect(fn) {\n    const _effect = new ReactiveEffect(fn);\n    _effect.run();\n};", "import { track, trigger } from \"./effect\";\n\nexport const enum ReactiveFlags {\n    IS_REACTIVE = '_v_isReactive'\n}\n\nexport const baseHandler = {\n    get(target, key, receiver) {\n        console.log('get');\n        if(key === ReactiveFlags.IS_REACTIVE) {\n            return true\n        }\n        track(target, key)\n        return Reflect.get(target, key, receiver)\n    },\n    set(target, key, value, receiver) {\n        console.log('set');\n        let oldValue = target[key];\n        if(oldValue !== value) {\n           let result = Reflect.set(target, key, value, receiver);\n           trigger(target, key, value);\n           return result\n        }\n    }\n}", "import { isObj } from \"@vue/shared\";\nimport {baseHandler, ReactiveFlags} from \"./baseHandler\";\n\nconst reactiveMap = new WeakMap();\n\nexport function reactive(target) {\n    if(!isObj(target)) {\n        return target\n    }\n    if(target[ReactiveFlags.IS_REACTIVE]) {\n        return target\n    }\n    const existing = reactiveMap.get(target);\n    if(existing) {\n        return existing\n    }\n\n    const proxy = new Proxy(target, baseHandler);\n    reactiveMap.set(target, proxy)\n    return proxy;\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAO,MAAM,QAAQ,CAAC,QAAQ;AAC1B,WAAO,OAAO,QAAQ,YAAY,QAAQ;AAAA,EAC9C;;;ACFO,MAAI,eAAe;AAEnB,MAAM,iBAAN,MAAqB;AAAA,IAKxB,YAAY,IAAI;AAJhB,WAAO,SAAS;AAChB,WAAO,SAAS;AAChB,WAAO,OAAO,CAAC;AAGX,WAAK,KAAK;AAAA,IACd;AAAA,IACA,MAAM;AACF,UAAG,CAAC,KAAK,QAAQ;AACb,aAAK,GAAG;AAAA,MACZ,OAAO;AACH,YAAI;AACA,eAAK,SAAS;AACd,yBAAe;AACf,iBAAO,KAAK,GAAG;AAAA,QACnB,UAAE;AACE,yBAAe,KAAK;AACpB,eAAK,SAAS;AAAA,QAClB;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAGA,MAAM,YAAY,oBAAI,QAAQ;AACvB,WAAS,QAAQ,QAAQ,KAAK,OAAO;AACxC,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAG,CAAC,SAAS;AACT;AAAA,IACJ;AACA,UAAM,UAAU,QAAQ,IAAI,GAAG;AAC/B,eAAW,QAAQ,QAAQ,CAAAA,YAAU;AACjC,UAAGA,YAAW,cAAc;AACxB,QAAAA,QAAO,IAAI;AAAA,MACf;AAAA,IACJ,CAAC;AAAA,EACL;AAEO,WAAS,MAAM,QAAQ,KAAK;AAC/B,QAAG,cAAc;AACb,UAAI,UAAU,UAAU,IAAI,MAAM;AAClC,UAAG,CAAC,SAAS;AACT,kBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,MAC/C;AACA,UAAI,OAAO,QAAQ,IAAI,GAAG;AAC1B,UAAG,CAAC,MAAM;AACN,gBAAQ,IAAI,KAAM,OAAO,oBAAI,IAAI,CAAE;AAAA,MACvC;AACA,UAAI,cAAc,CAAC,KAAK,IAAI,YAAY;AACxC,UAAG,aAAa;AACZ,aAAK,IAAI,YAAY;AACrB,qBAAa,KAAK,KAAK,IAAI;AAAA,MAC/B;AAAA,IACJ;AACA,YAAQ,IAAI,SAAS;AAAA,EAEzB;AAEO,WAAS,OAAO,IAAI;AACvB,UAAM,UAAU,IAAI,eAAe,EAAE;AACrC,YAAQ,IAAI;AAAA,EAChB;;;AC1DO,MAAM,cAAc;AAAA,IACvB,IAAI,QAAQ,KAAK,UAAU;AACvB,cAAQ,IAAI,KAAK;AACjB,UAAG,QAAQ,mCAA2B;AAClC,eAAO;AAAA,MACX;AACA,YAAM,QAAQ,GAAG;AACjB,aAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,IAC5C;AAAA,IACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAC9B,cAAQ,IAAI,KAAK;AACjB,UAAI,WAAW,OAAO;AACtB,UAAG,aAAa,OAAO;AACpB,YAAI,SAAS,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AACrD,gBAAQ,QAAQ,KAAK,KAAK;AAC1B,eAAO;AAAA,MACV;AAAA,IACJ;AAAA,EACJ;;;ACrBA,MAAM,cAAc,oBAAI,QAAQ;AAEzB,WAAS,SAAS,QAAQ;AAC7B,QAAG,CAAC,MAAM,MAAM,GAAG;AACf,aAAO;AAAA,IACX;AACA,QAAG,2CAAmC;AAClC,aAAO;AAAA,IACX;AACA,UAAM,WAAW,YAAY,IAAI,MAAM;AACvC,QAAG,UAAU;AACT,aAAO;AAAA,IACX;AAEA,UAAM,QAAQ,IAAI,MAAM,QAAQ,WAAW;AAC3C,gBAAY,IAAI,QAAQ,KAAK;AAC7B,WAAO;AAAA,EACX;",
  "names": ["effect"]
}
