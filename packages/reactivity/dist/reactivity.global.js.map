{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { reactive } from \"./reactive\";\nexport { effect } from \"./effect\";", "export const isObj = (val) => {\n    return typeof val === 'object' && val !== null\n}", "export let activeEffect = undefined;\n\nfunction cleanEffect(effect) {\n    let deps = effect.deps;\n    for (let i = 0; i < deps.length; i++) {\n        deps[i].delete(effect)\n    }\n    effect.deps.length = 0;\n}\n\nexport class ReactiveEffect {\n    public active = true;\n    public parent = null;\n    public deps = [];\n    constructor(public fn, public scheduler) {\n        this.fn = fn;\n    }\n    run() {\n        if (!this.active) {\n            return this.fn()\n        } else {\n            try {\n                this.parent = activeEffect;\n                activeEffect = this;\n                cleanEffect(this);\n                return this.fn()\n            } finally {\n                activeEffect = this.parent;\n                this.parent = null;\n            }\n        }\n    };\n    stop() {\n        if (this.active) {\n            this.active = false;\n            cleanEffect(this)\n        }\n    }\n};\n\n//map {object: {name:[effect, effect], age:[effect,effect]}}\nconst targetMap = new WeakMap();\nexport function trigger(target, key, value) {\n    let depsMap = targetMap.get(target);\n    if (!depsMap) {\n        return;\n    }\n    let effects = depsMap.get(key);\n    if (effects) {\n        effects = new Set(effects);\n        effects && effects.forEach(effect => {\n            if (effect !== activeEffect) {\n                if(effect.scheduler) {\n                    effect.scheduler()\n                } else {\n                    effect.run();\n                }\n            }\n        });\n    }\n};\n\nexport function track(target, key) {\n    if (activeEffect) {\n        let depsMap = targetMap.get(target);\n        if (!depsMap) {\n            targetMap.set(target, (depsMap = new Map()));\n        }\n        let deps = depsMap.get(key);\n        if (!deps) {\n            depsMap.set(key, (deps = new Set()));\n        }\n        let shouldTrack = !deps.has(activeEffect);\n        if (shouldTrack) {\n            deps.add(activeEffect);\n            activeEffect.deps.push(deps);\n        }\n    }\n}\n\nexport function effect(fn, options: any = {}) {\n    const _effect = new ReactiveEffect(fn, options.scheduler);\n    _effect.run();\n    const runner = _effect.run.bind(_effect);\n    runner.effect = _effect;\n    return runner\n};", "import { isObj } from \"@vue/shared\";\nimport { track, trigger } from \"./effect\";\nimport { reactive } from \"./reactive\";\n\nexport const enum ReactiveFlags {\n    IS_REACTIVE = '_v_isReactive'\n}\n\nexport const baseHandler = {\n    get(target, key, receiver) {\n        if(key === ReactiveFlags.IS_REACTIVE) {\n            return true\n        }\n        track(target, key)\n        let res = Reflect.get(target, key, receiver);\n        if(isObj(res)) {\n            return reactive(res)\n        }\n        return res\n    },\n    set(target, key, value, receiver) {\n        let oldValue = target[key];\n        if(oldValue !== value) {\n           let result = Reflect.set(target, key, value, receiver);\n           trigger(target, key, value);\n           return result\n        }\n    }\n}", "import { isObj } from \"@vue/shared\";\nimport {baseHandler, ReactiveFlags} from \"./baseHandler\";\n\nconst reactiveMap = new WeakMap();\n\nexport function reactive(target) {\n    if(!isObj(target)) {\n        return target\n    }\n    if(target[ReactiveFlags.IS_REACTIVE]) {\n        return target\n    }\n    const existing = reactiveMap.get(target);\n    if(existing) {\n        return existing\n    }\n\n    const proxy = new Proxy(target, baseHandler);\n    reactiveMap.set(target, proxy)\n    return proxy;\n}"],
  "mappings": "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",
  "names": ["effect", "effect"]
}
